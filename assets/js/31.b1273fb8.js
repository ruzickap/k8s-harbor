(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{348:function(a,e,s){"use strict";s.r(e);var t=s(8),r=Object(t.a)({},(function(){var a=this,e=a._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("h1",{attrs:{id:"clean-up"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#clean-up"}},[a._v("#")]),a._v(" Clean-up")]),a._v(" "),e("p",[e("img",{attrs:{src:"https://raw.githubusercontent.com/aws-samples/eks-workshop/65b766c494a5b4f5420b2912d8373c4957163541/static/images/cleanup.svg?sanitize=true",alt:"Clean-up",title:"Clean-up"}})]),a._v(" "),e("hr"),a._v(" "),e("p",[a._v("Configure "),e("code",[a._v("kubeconfig")]),a._v(":")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("MY_DOMAIN")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"mylabs.dev"')]),a._v("\neksctl utils write-kubeconfig "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--kubeconfig")]),a._v(" kubeconfig.conf "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${"),e("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("USER")]),a._v("}")]),a._v("-k8s-harbor\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("KUBECONFIG")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${KUBECONFIG"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":-")]),a._v("$PWD"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("kubeconfig.conf}")]),a._v("\n")])])]),e("p",[a._v("Remove Windows Server 2016 CloudFormation stack:")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("aws cloudformation delete-stack --stack-name eksctl-"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${"),e("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("USER")]),a._v("}")]),a._v("-k8s-harbor-cluster-windows-server-2016\n")])])]),e("p",[a._v("Remove Gitea:")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("helm delete "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--purge")]),a._v(" gitea\nkubectl delete namespace gitea-system "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--wait")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("false\n")])])]),e("p",[a._v("Remove Harbor:")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("helm delete "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--purge")]),a._v(" harbor\nkubectl delete namespace harbor-system "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--wait")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("false\n")])])]),e("p",[a._v("Remove kubed:")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("helm delete "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--purge")]),a._v(" kubed\n")])])]),e("p",[a._v("Remove cert-manager:")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("helm delete "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--purge")]),a._v(" cert-manager\nkubectl delete "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" https://raw.githubusercontent.com/jetstack/cert-manager/release-0.10/deploy/manifests/00-crds.yaml "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--wait")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("false\nkubectl delete namespace cert-manager "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--wait")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("false\n")])])]),e("p",[a._v("Remove Nginx-ingress:")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("helm delete "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--purge")]),a._v(" nginx-ingress\nkubectl delete namespace nginx-ingress-system "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--wait")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("false\nkubectl delete namespace mytest "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--wait")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("false\n")])])]),e("p",[a._v("Cleanup + Remove Helm:")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("helm repo remove harbor jetstack appscode library\nhelm reset --remove-helm-home\nkubectl delete serviceaccount tiller "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--namespace")]),a._v(" kube-system "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--wait")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("false\nkubectl delete clusterrolebinding tiller-cluster-rule "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--wait")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("false\n")])])]),e("p",[a._v("Output:")]),a._v(" "),e("div",{staticClass:"language-text extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("Deleting /home/pruzicka/.helm\nTiller (the Helm server-side component) has been uninstalled from your Kubernetes Cluster.\n")])])]),e("p",[a._v("Remove EKS cluster:")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("eksctl delete cluster "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${"),e("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("USER")]),a._v("}")]),a._v("-k8s-harbor\n")])])]),e("p",[a._v("Output:")]),a._v(" "),e("div",{staticClass:"language-text extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v('[ℹ]  using region eu-central-1\n[ℹ]  deleting EKS cluster "pruzicka-k8s-harbor"\n[✔]  kubeconfig has been updated\n[ℹ]  2 sequential tasks: { delete nodegroup "ng-d1b535b2", delete cluster control plane "pruzicka-k8s-harbor" [async] }\n[ℹ]  will delete stack "eksctl-pruzicka-k8s-harbor-nodegroup-ng-d1b535b2"\n[ℹ]  waiting for stack "eksctl-pruzicka-k8s-harbor-nodegroup-ng-d1b535b2" to get deleted\n[ℹ]  will delete stack "eksctl-pruzicka-k8s-harbor-cluster"\n[✔]  all cluster resources were deleted\n')])])]),e("p",[a._v("Clean Policy, User, Access Key in AWS:")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[a._v('# aws route53 delete-hosted-zone --id $(aws route53 list-hosted-zones --query "HostedZones[?Name==\\`${MY_DOMAIN}.\\`].Id" --output text)')]),a._v("\naws iam detach-user-policy --user-name "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"'),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${"),e("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("USER")]),a._v("}")]),a._v('-eks-cert-manager-route53"')]),a._v(" --policy-arn "),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),a._v("aws iam list-policies "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--query")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"Policies[?PolicyName==\\'),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")]),a._v("$"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),e("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("USER")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("-AmazonRoute53Domains-cert-manager"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")])]),a._v('].{ARN:Arn}"')]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--output")]),a._v(" text"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v("\naws iam delete-policy --policy-arn "),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),a._v("aws iam list-policies "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--query")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"Policies[?PolicyName==\\'),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")]),a._v("$"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),e("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("USER")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("-AmazonRoute53Domains-cert-manager"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")])]),a._v('].{ARN:Arn}"')]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--output")]),a._v(" text"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v("\naws iam delete-access-key --user-name "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${"),e("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("USER")]),a._v("}")]),a._v("-eks-cert-manager-route53 --access-key-id "),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),a._v("aws iam list-access-keys --user-name $"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),e("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("USER")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("-eks-cert-manager-route53 "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--query")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"AccessKeyMetadata[].AccessKeyId"')]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--output")]),a._v(" text"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v("\naws iam delete-user --user-name "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${"),e("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("USER")]),a._v("}")]),a._v("-eks-cert-manager-route53\n")])])]),e("p",[a._v("Docker clean-up:")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("test")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" ~/.docker/ "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&&")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-rf")]),a._v(" ~/.docker/\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("DOCKER_CONTAINERS")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("ps")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-a")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-q")]),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-n")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"'),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${DOCKER_CONTAINERS}")]),a._v('"')]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&&")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" stop "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${DOCKER_CONTAINERS}")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&&")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${DOCKER_CONTAINERS}")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("DOCKER_IMAGES")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" images "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-q")]),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-n")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"'),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${DOCKER_IMAGES}")]),a._v('"')]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&&")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" rmi "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--force")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${DOCKER_IMAGES}")]),a._v("\n")])])]),e("p",[a._v("Notary clean-up:")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("test")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" ~/.notary/ "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&&")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-rf")]),a._v(" ~/.notary/\n")])])]),e("p",[a._v("Docker certificate cleanup if exists:")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-rf")]),a._v(" /etc/docker/certs.d/harbor."),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${MY_DOMAIN}")]),a._v("\n")])])]),e("p",[a._v("Remove "),e("code",[a._v("tmp")]),a._v(" directory:")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-rf")]),a._v(" tmp\n")])])]),e("p",[a._v("Remove other files:")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" demo-magic.sh kubeconfig.conf README.sh "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&>")]),a._v(" /dev/null\n")])])])])}),[],!1,null,null,null);e.default=r.exports}}]);