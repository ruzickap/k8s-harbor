(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{304:function(r,a,s){r.exports=s.p+"assets/img/harbor_login_page.703b5e90.png"},305:function(r,a,s){r.exports=s.p+"assets/img/harbor_projects.338db00b.png"},343:function(r,a,s){"use strict";s.r(a);var e=s(8),t=Object(e.a)({},(function(){var r=this,a=r._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":r.$parent.slotKey}},[a("h1",{attrs:{id:"install-harbor"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#install-harbor"}},[r._v("#")]),r._v(" Install Harbor")]),r._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/cncf/artwork/c33a8386bce4eabc36e1d4972e0996db4630037b/projects/harbor/horizontal/color/harbor-horizontal-color.svg?sanitize=true",alt:"Harbor logo",title:"Harbor logo"}})]),r._v(" "),a("h2",{attrs:{id:"install-harbor-using-helm"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#install-harbor-using-helm"}},[r._v("#")]),r._v(" Install Harbor using Helm")]),r._v(" "),a("p",[r._v("Lab architecture:")]),r._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/ruzickap/k8s-harbor-presentation/master/images/harbor_demo_architecture_diagram.svg?sanitize=true",alt:"Lab architecture",title:"Lab architecture"}})]),r._v(" "),a("p",[r._v("Label Harbor namespace and copy there the secret with certificates signed by\nLet's Encrypt certificate:")]),r._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[r._v("kubectl get namespace harbor-system "),a("span",{pre:!0,attrs:{class:"token operator"}},[r._v("&>")]),r._v(" /dev/null "),a("span",{pre:!0,attrs:{class:"token operator"}},[r._v("||")]),r._v(" kubectl create namespace harbor-system\nkubectl label namespace "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[r._v("--overwrite")]),r._v(" harbor-system "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[r._v("app")]),a("span",{pre:!0,attrs:{class:"token operator"}},[r._v("=")]),r._v("kubed\n")])])]),a("p",[r._v("Output:")]),r._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[r._v("namespace/harbor-system labeled\n")])])]),a("p",[r._v("Check if the certificate generated by cert-manager in "),a("code",[r._v("cert-manager")]),r._v(" namespace\nwas successfully copied to "),a("code",[r._v("harbor-system")]),r._v(" namespace:")]),r._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[r._v("kubectl get secrets ingress-cert-"),a("span",{pre:!0,attrs:{class:"token variable"}},[r._v("${LETSENCRYPT_ENVIRONMENT}")]),r._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[r._v("-n")]),r._v(" harbor-system "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[r._v("-o")]),r._v(" json "),a("span",{pre:!0,attrs:{class:"token operator"}},[r._v("|")]),r._v(" jq "),a("span",{pre:!0,attrs:{class:"token string"}},[r._v('".metadata | .annotations, .labels"')]),r._v("\n")])])]),a("p",[r._v("Output:")]),r._v(" "),a("div",{staticClass:"language-json extra-class"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[r._v("Â ")]),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[r._v("{")]),r._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[r._v('"certmanager.k8s.io/alt-names"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[r._v(":")]),r._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[r._v('"*.mylabs.dev"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[r._v(",")]),r._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[r._v('"certmanager.k8s.io/common-name"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[r._v(":")]),r._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[r._v('"*.mylabs.dev"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[r._v(",")]),r._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[r._v('"certmanager.k8s.io/ip-sans"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[r._v(":")]),r._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[r._v('""')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[r._v(",")]),r._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[r._v('"certmanager.k8s.io/issuer-kind"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[r._v(":")]),r._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[r._v('"ClusterIssuer"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[r._v(",")]),r._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[r._v('"certmanager.k8s.io/issuer-name"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[r._v(":")]),r._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[r._v('"letsencrypt-production-dns"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[r._v(",")]),r._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[r._v('"kubed.appscode.com/origin"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[r._v(":")]),r._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[r._v('"{\\"namespace\\":\\"cert-manager\\",\\"name\\":\\"ingress-cert-production\\",\\"uid\\":\\"51b889ad-aa0a-11e9-8d10-06a66d4e34ba\\",\\"resourceVersion\\":\\"2916\\"}"')]),r._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[r._v("}")]),r._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[r._v("{")]),r._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[r._v('"certmanager.k8s.io/certificate-name"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[r._v(":")]),r._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[r._v('"ingress-cert-production"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[r._v(",")]),r._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[r._v('"kubed.appscode.com/origin.cluster"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[r._v(":")]),r._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[r._v('"my_k8s_cluster"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[r._v(",")]),r._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[r._v('"kubed.appscode.com/origin.name"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[r._v(":")]),r._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[r._v('"ingress-cert-production"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[r._v(",")]),r._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[r._v('"kubed.appscode.com/origin.namespace"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[r._v(":")]),r._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[r._v('"cert-manager"')]),r._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[r._v("}")]),r._v("\n")])])]),a("p",[r._v("Add Harbor Helm repository:")]),r._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[r._v("helm repo "),a("span",{pre:!0,attrs:{class:"token function"}},[r._v("add")]),r._v(" harbor https://helm.goharbor.io\n")])])]),a("p",[r._v("Output:")]),r._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[r._v('"harbor" has been added to your repositories\n')])])]),a("p",[r._v("Install Harbor using Helm:")]),r._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[r._v("helm "),a("span",{pre:!0,attrs:{class:"token function"}},[r._v("ls")]),r._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[r._v("|")]),r._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[r._v("grep")]),r._v(" harbor "),a("span",{pre:!0,attrs:{class:"token operator"}},[r._v("||")]),r._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[r._v("\\")]),r._v("\nhelm "),a("span",{pre:!0,attrs:{class:"token function"}},[r._v("install")]),r._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[r._v("--wait")]),r._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[r._v("--name")]),r._v(" harbor "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[r._v("--namespace")]),r._v(" harbor-system harbor/harbor "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[r._v("--version")]),r._v(" v1.2.1 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[r._v("\\")]),r._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[r._v("--set")]),r._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[r._v("expose.ingress.hosts.core")]),a("span",{pre:!0,attrs:{class:"token operator"}},[r._v("=")]),r._v("harbor."),a("span",{pre:!0,attrs:{class:"token variable"}},[r._v("${MY_DOMAIN}")]),r._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[r._v("\\")]),r._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[r._v("--set")]),r._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[r._v("expose.ingress.hosts.notary")]),a("span",{pre:!0,attrs:{class:"token operator"}},[r._v("=")]),r._v("notary."),a("span",{pre:!0,attrs:{class:"token variable"}},[r._v("${MY_DOMAIN}")]),r._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[r._v("\\")]),r._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[r._v("--set")]),r._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[r._v("expose.tls.secretName")]),a("span",{pre:!0,attrs:{class:"token operator"}},[r._v("=")]),r._v("ingress-cert-"),a("span",{pre:!0,attrs:{class:"token variable"}},[r._v("${LETSENCRYPT_ENVIRONMENT}")]),r._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[r._v("\\")]),r._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[r._v("--set")]),r._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[r._v("persistence.enabled")]),a("span",{pre:!0,attrs:{class:"token operator"}},[r._v("=")]),r._v("false "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[r._v("\\")]),r._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[r._v("--set")]),r._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[r._v("externalURL")]),a("span",{pre:!0,attrs:{class:"token operator"}},[r._v("=")]),r._v("https://harbor."),a("span",{pre:!0,attrs:{class:"token variable"}},[r._v("${MY_DOMAIN}")]),r._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[r._v("\\")]),r._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[r._v("--set")]),r._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[r._v("harborAdminPassword")]),a("span",{pre:!0,attrs:{class:"token operator"}},[r._v("=")]),r._v("admin\n")])])]),a("p",[r._v("Output:")]),r._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[r._v("NAME:   harbor\nLAST DEPLOYED: Fri Jul 19 11:49:59 2019\nNAMESPACE: harbor-system\nSTATUS: DEPLOYED\n\nRESOURCES:\n==> v1/ConfigMap\nNAME                         DATA  AGE\nharbor-harbor-chartmuseum    23    65s\nharbor-harbor-clair          1     65s\nharbor-harbor-core           34    65s\nharbor-harbor-jobservice     1     65s\nharbor-harbor-notary-server  5     65s\nharbor-harbor-registry       2     65s\n\n==> v1/Deployment\nNAME                         READY  UP-TO-DATE  AVAILABLE  AGE\nharbor-harbor-chartmuseum    1/1    1           1          65s\nharbor-harbor-clair          1/1    1           1          65s\nharbor-harbor-core           1/1    1           1          65s\nharbor-harbor-jobservice     1/1    1           1          65s\nharbor-harbor-notary-server  1/1    1           1          65s\nharbor-harbor-notary-signer  1/1    1           1          65s\nharbor-harbor-portal         1/1    1           1          65s\nharbor-harbor-registry       1/1    1           1          65s\n\n==> v1/Pod(related)\nNAME                                          READY  STATUS   RESTARTS  AGE\nharbor-harbor-chartmuseum-8647f45994-8nvd7    1/1    Running  0         65s\nharbor-harbor-clair-55c56ccf4-kjc67           1/1    Running  2         65s\nharbor-harbor-core-8554f8c5cd-n5dks           1/1    Running  0         65s\nharbor-harbor-database-0                      1/1    Running  0         64s\nharbor-harbor-jobservice-5989b8c6c4-nwxns     1/1    Running  0         65s\nharbor-harbor-notary-server-694d84d7-vwgdm    1/1    Running  0         65s\nharbor-harbor-notary-signer-749cbf5948-b7b6g  1/1    Running  0         65s\nharbor-harbor-portal-64899d584-gtr4x          1/1    Running  0         64s\nharbor-harbor-redis-0                         1/1    Running  0         64s\nharbor-harbor-registry-69bb76d7-8pcf9         2/2    Running  0         64s\n\n==> v1/Secret\nNAME                       TYPE    DATA  AGE\nharbor-harbor-chartmuseum  Opaque  1     65s\nharbor-harbor-core         Opaque  7     65s\nharbor-harbor-database     Opaque  1     65s\nharbor-harbor-jobservice   Opaque  1     65s\nharbor-harbor-registry     Opaque  2     65s\n\n==> v1/Service\nNAME                         TYPE       CLUSTER-IP      EXTERNAL-IP  PORT(S)            AGE\nharbor-harbor-chartmuseum    ClusterIP  10.100.188.79   &lt;none>       80/TCP             65s\nharbor-harbor-clair          ClusterIP  10.100.157.91   &lt;none>       6060/TCP,6061/TCP  65s\nharbor-harbor-core           ClusterIP  10.100.95.26    &lt;none>       80/TCP             65s\nharbor-harbor-database       ClusterIP  10.100.126.163  &lt;none>       5432/TCP           65s\nharbor-harbor-jobservice     ClusterIP  10.100.210.198  &lt;none>       80/TCP             65s\nharbor-harbor-notary-server  ClusterIP  10.100.249.4    &lt;none>       4443/TCP           65s\nharbor-harbor-notary-signer  ClusterIP  10.100.192.142  &lt;none>       7899/TCP           65s\nharbor-harbor-portal         ClusterIP  10.100.154.171  &lt;none>       80/TCP             65s\nharbor-harbor-redis          ClusterIP  10.100.156.84   &lt;none>       6379/TCP           65s\nharbor-harbor-registry       ClusterIP  10.100.27.218   &lt;none>       5000/TCP,8080/TCP  65s\n\n==> v1/StatefulSet\nNAME                    READY  AGE\nharbor-harbor-database  1/1    65s\nharbor-harbor-redis     1/1    64s\n\n==> v1beta1/Ingress\nNAME                   HOSTS                                ADDRESS      PORTS    AGE\nharbor-harbor-ingress  harbor.mylabs.dev,notary.mylabs.dev  54.93.96.15  80, 443  64s\n\n\nNOTES:\nPlease wait for several minutes for Harbor deployment to complete.\nThen you should be able to visit the Harbor portal at https://harbor.mylabs.dev.\nFor more details, please visit https://github.com/goharbor/harbor.\n")])])]),a("p",[r._v("Harbor architecture:")]),r._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/goharbor/harbor/5d31dd5b57d83f300907744aabf13ca60aac19b3/docs/img/harbor-arch.png",alt:"Harbor Architecture",title:"Harbor Architecture"}})]),r._v(" "),a("p",[r._v("Check how the Harbor Ingress looks like:")]),r._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[r._v("kubectl describe ingresses "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[r._v("-n")]),r._v(" harbor-system harbor-harbor-ingress\n")])])]),a("p",[r._v("Output:")]),r._v(" "),a("div",{staticClass:"language-text extra-class"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[r._v("Â ")]),a("div",{staticClass:"highlighted"},[r._v("Â ")]),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[r._v("Â ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[r._v("Â ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[r._v("Name:             harbor-harbor-ingress\nNamespace:        harbor-system\nAddress:          54.93.96.15\nDefault backend:  default-http-backend:80 (&lt;none>)\nTLS:\n  ingress-cert-production terminates harbor.mylabs.dev\n  ingress-cert-production terminates notary.mylabs.dev\nRules:\n  Host               Path  Backends\n  ----               ----  --------\n  harbor.mylabs.dev\n                     /             harbor-harbor-portal:80 (192.168.52.252:80)\n                     /api/         harbor-harbor-core:80 (192.168.34.28:8080)\n                     /service/     harbor-harbor-core:80 (192.168.34.28:8080)\n                     /v2/          harbor-harbor-core:80 (192.168.34.28:8080)\n                     /chartrepo/   harbor-harbor-core:80 (192.168.34.28:8080)\n                     /c/           harbor-harbor-core:80 (192.168.34.28:8080)\n  notary.mylabs.dev\n                     /   harbor-harbor-notary-server:4443 (192.168.47.135:4443)\nAnnotations:\n  ingress.kubernetes.io/ssl-redirect:           true\n  nginx.ingress.kubernetes.io/proxy-body-size:  0\n  nginx.ingress.kubernetes.io/ssl-redirect:     true\n  ingress.kubernetes.io/proxy-body-size:        0\nEvents:\n  Type    Reason  Age   From                      Message\n  ----    ------  ----  ----                      -------\n  Normal  CREATE  29m   nginx-ingress-controller  Ingress harbor-system/harbor-harbor-ingress\n  Normal  UPDATE  29m   nginx-ingress-controller  Ingress harbor-system/harbor-harbor-ingress\n")])])]),a("p",[r._v("Open the "),a("a",{attrs:{href:"https://harbor.mylabs.dev",target:"_blank",rel:"noopener noreferrer"}},[r._v("https://harbor.mylabs.dev"),a("OutboundLink")],1),r._v(":")]),r._v(" "),a("p",[a("img",{attrs:{src:s(304),alt:"Harbor login page",title:"Harbor login page"}})]),r._v(" "),a("p",[r._v("Log in:")]),r._v(" "),a("ul",[a("li",[r._v("User: "),a("code",[r._v("admin")])]),r._v(" "),a("li",[r._v("Password: "),a("code",[r._v("admin")])])]),r._v(" "),a("p",[r._v("You should see the Web UI:")]),r._v(" "),a("p",[a("img",{attrs:{src:s(305),alt:"Harbor",title:"Harbor"}})])])}),[],!1,null,null,null);a.default=t.exports}}]);